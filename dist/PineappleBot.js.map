{"version":3,"sources":["../src/PineappleBot.js"],"names":["bot","config","Error","__config","__reddit","__initRedditClient","__discord","__initDiscordClient","__dot","__initTemplateEngine","__router","__initDiscordRouter","__initBotEvents","userAgent","clientId","clientSecret","refreshToken","Client","ws","compress","process","templateSettings","strip","path","DiscordRouter","discordCommands","on","console","log","user","setGame","commandPrefix","catch","error","msg","handleMessage","oldMessage","newMessage","exit","author","cmd","checkMessagesForCommand","subreddit","content","substring","length","channel","sendMessage","then","message","delete","e","msgTxt","debug","stack","login","discordToken","respsonse"],"mappings":"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","file":"PineappleBot.js","sourcesContent":["'use strict';\n\nimport Config from 'config';\nimport Snoowrap from 'snoowrap';\nimport Discord from 'discord.js';\nimport Dot from 'dot';\n//import DateFormat from 'dateformat';\n\n\nexport default class bot {\n\n    /**\n     * @summary initialises the bot\n     *\n     * @param {Config} config\n     */\n    constructor( config ) {\n\n        if (typeof config !== 'Config') {\n            throw new Error('need a proper __config thanks knobcheese');\n        }\n\n        /**\n         *\n         * @type {Config}\n         */\n        this.__config = config;\n\n        /**\n         * The reddit client\n         *\n         * @type {Snoowrap}\n         */\n        this.__reddit = this.__initRedditClient();\n\n        /**\n         * The discord client\n         *\n         * @type {Discord.client}\n         */\n        this.__discord = this.__initDiscordClient();\n\n        /**\n         * The template engine\n         *\n         * @type {Dot}\n         * @private\n         */\n        this.__dot = this.__initTemplateEngine();\n\n\n\n        /**\n         * @type {DiscordRouter}\n         * @priate\n         */\n        this.__router = this.__initDiscordRouter();\n\n        this.__initBotEvents();\n    }\n\n    /**\n     * Sets up snoowrap\n     *\n     * @returns Snoowrap\n     * @private\n     */\n    __initRedditClient() {\n        return new Snoowrap( {\n            userAgent: this.userAgent,\n            clientId: this.clientId,\n            clientSecret: this.clientSecret,\n            refreshToken: this.refreshToken\n        } );\n\n\n    }\n\n    /**\n     * Sets up discord\n     *\n     * @returns Discord.client\n     * @private\n     */\n    __initDiscordClient() {\n        return new Discord.Client( {\n            ws: {\n                compress: true\n            }\n        } );\n    }\n\n    /**\n     * Sets up the Dot template engine\n     *\n     * @returns Dot\n     * @private\n     * @static\n     */\n    __initTemplateEngine() {\n        return Dot.process( { templateSettings: { strip: false }, path: 'views/' } );\n    }\n\n    __initDiscordRouter() {\n        return new DiscordRouter( this.discordCommands, this.__discord, this.__dot, this.__reddit );\n    }\n\n    /**\n     * Sets up the bot events\n     *\n     * @private\n     */\n    __initBotEvents() {\n        this.__discord.on( 'ready', () => {\n            console.log( 'Logged in to discord!' );\n            this\n                .__discord.user\n                .setGame( this.commandPrefix + 'help' )\n                .catch(\n                    ( error ) => {\n                        throw(error);\n                    } );\n\n        } );\n        this.__discord.on( 'message', ( msg ) => this.handleMessage( msg ) );\n        this.__discord.on( 'messageUpdate', ( oldMessage, newMessage ) => this.handleMessage( newMessage ) );\n        this.__discord.on( 'disconnected', () => {\n            console.log( 'Disconnected!' );\n            process.exit( 1 ); //exit node.js with an error\n        } );\n    }\n\n    /**\n     *\n     * @param msg { Discord.Message }\n     * @returns {*}\n     */\n    handleMessage( msg ) {\n        try {\n            if (msg.author !== this.__discord.user) {\n                let cmd = this.__router.checkMessagesForCommand( msg );\n\n                if ( cmd !== false ) {\n                    return cmd.process( msg, { subreddit: this.subreddit } );\n                }\n\n                if (msg.content.substring( 0, this.commandPrefix.length ) === this.commandPrefix) {\n                    msg.channel.sendMessage(\n                        'Not recognized as a command! Try ' + this.commandPrefix + 'help' ).then( (message => message.delete( 5000 ))\n                    );\n                }\n            }\n\n            return false;\n        } catch ( e ) {\n            let msgTxt = 'fail! :(';\n            if ( this.debug ) {\n                msgTxt += '\\n' + e.stack;\n            }\n            msg.channel.sendMessage( msgTxt );\n            throw e;\n        }\n    }\n\n    /**\n     *\n     */\n    go() {\n        this.__discord.login( this.discordToken )\n            .then( ( respsonse ) => {\n                console.log( 'response', respsonse );\n            } )\n            .catch( ( error ) => {\n                throw error;\n            } );\n    }\n}"]}