{"version":3,"sources":["PineappleBot.js"],"names":["Object","defineProperty","exports","value","_defaults2","require","_defaults3","_interopRequireDefault","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_snoowrap","_snoowrap2","_discord","_discord2","_dot","_dot2","_DiscordRouter","_DiscordRouter2","_Help","_Help2","_Ping","_Ping2","_Top","_Top2","_Where","_Where2","obj","__esModule","default","_classCallCheck","instance","TypeError","bot","_ref","arguments","undefined","userAgent","clientId","clientSecret","refreshToken","subreddit","discordToken","discordServer","commandPrefix","Error","subbreddit","__reddit","__initRedditClient","__discord","__initDiscordClient","__dot","__initTemplateEngine","discordCommands","__router","__initDiscordRouter","__initBotEvents","Client","ws","compress","process","templateSettings","strip","path","_this","on","console","log","user","setGame","catch","error","msg","handleMessage","oldMessage","newMessage","exit","author","cmd","checkMessagesForCommand","content","substring","channel","sendMessage","then","message","delete","e","msgTxt","debug","stack","go","login","respsonse"],"mappings":"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","file":"PineappleBot.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _defaults2 = require('lodash/defaults');\n\nvar _defaults3 = _interopRequireDefault(_defaults2);\n\nvar _createClass = function () {\n    function defineProperties(target, props) {\n        for (var i = 0; i < props.length; i++) {\n            var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);\n        }\n    }return function (Constructor, protoProps, staticProps) {\n        if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;\n    };\n}();\n//import DateFormat from 'dateformat';\n\n\nvar _snoowrap = require('snoowrap');\n\nvar _snoowrap2 = _interopRequireDefault(_snoowrap);\n\nvar _discord = require('discord.js');\n\nvar _discord2 = _interopRequireDefault(_discord);\n\nvar _dot = require('dot');\n\nvar _dot2 = _interopRequireDefault(_dot);\n\nvar _DiscordRouter = require('./DiscordRouter');\n\nvar _DiscordRouter2 = _interopRequireDefault(_DiscordRouter);\n\nvar _Help = require('./Discord/Help');\n\nvar _Help2 = _interopRequireDefault(_Help);\n\nvar _Ping = require('./Discord/Ping');\n\nvar _Ping2 = _interopRequireDefault(_Ping);\n\nvar _Top = require('./Discord/Top');\n\nvar _Top2 = _interopRequireDefault(_Top);\n\nvar _Where = require('./Discord/Where');\n\nvar _Where2 = _interopRequireDefault(_Where);\n\nfunction _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : { default: obj };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n        throw new TypeError(\"Cannot call a class as a function\");\n    }\n}\n\nvar bot = function () {\n\n    /**\n     * @summary initialises the bot\n     *\n     * @param {string} [userAgent] A unique description of what your app does. This argument is not necessary when Snoowrap\n     is running in a browser.\n     * @param {string} [clientId] The client ID of your app (assigned by reddit)\n     * @param {string} [clientSecret] The client secret of your app (assigned by reddit). If you are using a refresh token\n     with an installed app (which does not have a client secret), pass an empty string as your `clientSecret`.\n     * @param {string} [refreshToken] A refresh token for your app.\n     * @param {string} [subreddit] The subreddit name we are going to be managing\n     * @param {string} [discordToken] Key for the stats api\n     * @param {string} [discordServer] The server to work in discord\n     * @param {string} [commandPrefix] The command prefix\n     */\n    function bot() {\n        var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n            userAgent = _ref.userAgent,\n            clientId = _ref.clientId,\n            clientSecret = _ref.clientSecret,\n            refreshToken = _ref.refreshToken,\n            subreddit = _ref.subreddit,\n            discordToken = _ref.discordToken,\n            discordServer = _ref.discordServer,\n            commandPrefix = _ref.commandPrefix;\n\n        _classCallCheck(this, bot);\n\n        if (clientId === undefined || clientSecret === undefined || refreshToken === undefined) {\n            throw new Error('Reddit Credentials not supplied, fuckwit');\n        }\n\n        if (discordToken === undefined) {\n            throw new Error('Discord Token needed, dickhead');\n        }\n\n        (0, _defaults3.default)(this, {\n            userAgent,\n            clientId,\n            clientSecret,\n            refreshToken,\n            subreddit,\n            discordToken,\n            discordServer,\n            commandPrefix\n        }, {\n            userAgent: null,\n            clientId: null,\n            clientSecret: null,\n            refreshToken: null,\n            subbreddit: 'uktrees',\n            discordToken: null,\n            discordServer: '#uktrees',\n            commandPrefix: '!'\n        });\n\n        /**\n         * The reddit client\n         *\n         * @type {Snoowrap}\n         */\n        this.__reddit = this.__initRedditClient();\n\n        /**\n         * The discord client\n         *\n         * @type {Discord.client}\n         */\n        this.__discord = this.__initDiscordClient();\n\n        /**\n         * The template engine\n         *\n         * @type {Dot}\n         * @private\n         */\n        this.__dot = this.__initTemplateEngine();\n\n        /**\n         *\n         * @type {{}}\n         */\n        this.discordCommands = {\n            'help': _Help2.default,\n            'ping': _Ping2.default,\n            'top': _Top2.default,\n            'where': _Where2.default\n        };\n\n        /**\n         * @type {DiscordRouter}\n         * @priate\n         */\n        this.__router = this.__initDiscordRouter();\n\n        this.__initBotEvents();\n    }\n\n    /**\n     * Sets up snoowrap\n     *\n     * @returns Snoowrap\n     * @private\n     */\n\n    _createClass(bot, [{\n        key: '__initRedditClient',\n        value: function __initRedditClient() {\n            return new _snoowrap2.default({\n                userAgent: this.userAgent,\n                clientId: this.clientId,\n                clientSecret: this.clientSecret,\n                refreshToken: this.refreshToken\n            });\n        }\n\n        /**\n         * Sets up discord\n         *\n         * @returns Discord.client\n         * @private\n         */\n\n    }, {\n        key: '__initDiscordClient',\n        value: function __initDiscordClient() {\n            return new _discord2.default.Client({\n                ws: {\n                    compress: true\n                }\n            });\n        }\n\n        /**\n         * Sets up the Dot template engine\n         *\n         * @returns Dot\n         * @private\n         * @static\n         */\n\n    }, {\n        key: '__initTemplateEngine',\n        value: function __initTemplateEngine() {\n            return _dot2.default.process({ templateSettings: { strip: false }, path: 'views/' });\n        }\n    }, {\n        key: '__initDiscordRouter',\n        value: function __initDiscordRouter() {\n            return new _DiscordRouter2.default(this.discordCommands, this.__discord, this.__dot, this.__reddit);\n        }\n\n        /**\n         * Sets up the bot events\n         *\n         * @private\n         */\n\n    }, {\n        key: '__initBotEvents',\n        value: function __initBotEvents() {\n            var _this = this;\n\n            this.__discord.on('ready', function () {\n                console.log('Logged in to discord!');\n                _this.__discord.user.setGame(_this.commandPrefix + 'help').catch(function (error) {\n                    throw error;\n                });\n            });\n            this.__discord.on('message', function (msg) {\n                return _this.handleMessage(msg);\n            });\n            this.__discord.on('messageUpdate', function (oldMessage, newMessage) {\n                return _this.handleMessage(newMessage);\n            });\n            this.__discord.on('disconnected', function () {\n                console.log('Disconnected!');\n                process.exit(1); //exit node.js with an error\n            });\n        }\n\n        /**\n         *\n         * @param msg { Discord.Message }\n         * @returns {*}\n         */\n\n    }, {\n        key: 'handleMessage',\n        value: function handleMessage(msg) {\n            try {\n                if (msg.author !== this.__discord.user) {\n                    var cmd = this.__router.checkMessagesForCommand(msg);\n\n                    if (cmd !== false) {\n                        return cmd.process(msg, { subreddit: this.subreddit });\n                    }\n\n                    if (msg.content.substring(0, this.commandPrefix.length) === this.commandPrefix) {\n                        msg.channel.sendMessage('Not recognized as a command! Try ' + this.commandPrefix + 'help').then(function (message) {\n                            return message.delete(5000);\n                        });\n                    }\n                }\n\n                return false;\n            } catch (e) {\n                var msgTxt = 'fail! :(';\n                if (this.debug) {\n                    msgTxt += '\\n' + e.stack;\n                }\n                msg.channel.sendMessage(msgTxt);\n                throw e;\n            }\n        }\n\n        /**\n         *\n         */\n\n    }, {\n        key: 'go',\n        value: function go() {\n            this.__discord.login(this.discordToken).then(function (respsonse) {\n                console.log('response', respsonse);\n            }).catch(function (error) {\n                throw error;\n            });\n        }\n    }]);\n\n    return bot;\n}();\n\nexports.default = bot;\n//# sourceMappingURL=PineappleBot.js.map\n//# sourceMappingURL=PineappleBot.js.map"]}